// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Meta from "./Meta.res.mjs";
import * as Core__Option from "@rescript/core/src/Core__Option.res.mjs";

var status_object = {
  version: "",
  user: "",
  error: ""
};

async function setStatus() {
  try {
    var url = Meta.endpoints.current_version;
    var response = await globalThis.fetch(url, {
          method: "GET"
        });
    var response_json = await response.json();
    var match = response_json[1];
    if (match !== undefined) {
      status_object.error = "More than one current version returned";
    }
    var element = response_json[0];
    if (element !== undefined) {
      status_object.version = "Mirante " + element.tag;
    } else {
      status_object.error = "No current version returned";
    }
  }
  catch (exn){
    console.log({
          TAG: "Error",
          _0: "Erro de conexão inesperado"
        });
  }
  var stored_credentials = sessionStorage.getItem(Meta.constants.storage_key);
  console.log(stored_credentials);
  try {
    if (stored_credentials == null) {
      status_object.user = "[Não autenticado]";
    } else {
      var credentials_json = JSON.parse(stored_credentials);
      status_object.user = "[" + credentials_json.email + "]";
    }
  }
  catch (exn$1){
    console.log({
          TAG: "Error",
          _0: "Erro de conexão inesperado"
        });
  }
  var status_element = Core__Option.getExn(document.getElementById("status"), "status_element not found");
  if (status_object.error !== "") {
    status_element.innerText = "Erro: " + status_object.error;
    return ;
  } else if (status_object.user !== "" && status_object.version !== "") {
    status_element.innerText = "Conectado: " + status_object.version + " " + status_object.user;
    return ;
  } else if (status_object.version !== "") {
    status_element.innerText = "Conectado: " + status_object.version;
    return ;
  } else {
    return ;
  }
}

export {
  setStatus ,
}
/* No side effect */
