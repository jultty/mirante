// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Core__Option from "@rescript/core/src/Core__Option.res.mjs";

var status_object = {
  version: "",
  user: "",
  error: ""
};

async function setStatus() {
  var fetch_options = {
    method: "GET"
  };
  try {
    var response = await globalThis.fetch("http://localhost:3031/version?current=is.true", fetch_options);
    var response_json = await response.json();
    var first_version = response_json[0];
    var match = first_version.tag;
    if (match === "") {
      status_object.error = "No version tag in response";
    } else {
      status_object.version = "Mirante " + first_version.tag;
    }
  }
  catch (exn){
    console.log({
          TAG: "Error",
          _0: "Erro de conexão inesperado"
        });
  }
  var stored_credentials = sessionStorage.getItem("mirante_credentials");
  try {
    if (stored_credentials == null) {
      status_object.user = "[Não autenticado]";
    } else {
      var credentials_json = JSON.parse(stored_credentials);
      status_object.user = "[" + credentials_json.email + "]";
    }
  }
  catch (exn$1){
    console.log({
          TAG: "Error",
          _0: "Erro de conexão inesperado"
        });
  }
  var status_element = Core__Option.getExn(document.getElementById("status"), "status_element not found");
  if (status_object.error !== "") {
    status_element.innerText = "Erro: " + status_object.error;
    return ;
  } else if (status_object.user !== "" && status_object.version !== "") {
    status_element.innerText = "Conectado: " + status_object.version + " " + status_object.user;
    return ;
  } else if (status_object.version !== "") {
    status_element.innerText = "Conectado: " + status_object.version;
    return ;
  } else {
    return ;
  }
}

export {
  setStatus ,
}
/* No side effect */
