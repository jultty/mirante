// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Auth from "./Auth.res.mjs";
import * as Meta from "./Meta.res.mjs";
import * as Browser from "./Browser.res.mjs";
import * as Caml_js_exceptions from "rescript/lib/es6/caml_js_exceptions.js";

var status_object = {
  version: "",
  user: "",
  error: ""
};

async function setStatus(param) {
  try {
    var response = await globalThis.fetch(Meta.schema.system.endpoints.version_current, {
          method: "GET"
        });
    var response_json = await response.json();
    var match = response_json[1];
    if (match !== undefined) {
      status_object.error = "More than one current version returned";
    }
    var element = response_json[0];
    if (element !== undefined) {
      status_object.version = "Mirante " + element.tag;
    } else {
      status_object.error = "No current version returned";
    }
  }
  catch (raw_error){
    var error = Caml_js_exceptions.internalToOCamlException(raw_error);
    console.log(error);
  }
  try {
    var credentials = Auth.getCredentialsOption();
    if (credentials !== undefined) {
      status_object.user = "[" + credentials.email + "]";
    } else {
      status_object.user = "[NÃ£o autenticado]";
    }
  }
  catch (raw_error$1){
    var error$1 = Caml_js_exceptions.internalToOCamlException(raw_error$1);
    console.log(error$1);
  }
  var status_element = Browser.getElement("status", "Status.setStatus");
  if (status_object.error !== "") {
    status_element.innerText = "Erro: " + status_object.error;
    return ;
  } else if (status_object.user !== "" && status_object.version !== "") {
    status_element.innerText = "Conectado: " + status_object.version + " " + status_object.user;
    return ;
  } else if (status_object.version !== "") {
    status_element.innerText = "Conectado: " + status_object.version;
    return ;
  } else {
    return ;
  }
}

export {
  setStatus ,
}
/* No side effect */
